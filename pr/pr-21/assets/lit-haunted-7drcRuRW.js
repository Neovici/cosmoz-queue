import{D}from"./iframe-CcVHdtaE.js";let _,P=0;function w(e){_=e}function g(){_=null,P=0}function H(){return P++}const y=Symbol("haunted.phase"),m=Symbol("haunted.hook"),C=Symbol("haunted.update"),x=Symbol("haunted.commit"),l=Symbol("haunted.effects"),p=Symbol("haunted.layoutEffects"),v="haunted.context";class z{update;host;virtual;[m];[l];[p];constructor(t,s){this.update=t,this.host=s,this[m]=new Map,this[l]=[],this[p]=[]}run(t){w(this);let s=t();return g(),s}_runEffects(t){let s=this[t];w(this);for(let r of s)r.call(this);g()}runEffects(){this._runEffects(l)}runLayoutEffects(){this._runEffects(p)}teardown(){this[m].forEach(s=>{typeof s.teardown=="function"&&s.teardown(!0)})}}const T=Promise.resolve().then.bind(Promise.resolve());function O(){let e=[],t;function s(){t=null;let r=e;e=[];for(var n=0,h=r.length;n<h;n++)r[n]()}return function(r){e.push(r),t==null&&(t=T(s))}}const B=O(),k=O();class I{renderer;host;state;[y];_updateQueued;_active;constructor(t,s){this.renderer=t,this.host=s,this.state=new z(this.update.bind(this),s),this[y]=null,this._updateQueued=!1,this._active=!0}update(){this._active&&(this._updateQueued||(B(()=>{let t=this.handlePhase(C);k(()=>{this.handlePhase(x,t),k(()=>{this.handlePhase(l)})}),this._updateQueued=!1}),this._updateQueued=!0))}handlePhase(t,s){switch(this[y]=t,t){case x:this.commit(s),this.runEffects(p);return;case C:return this.render();case l:return this.runEffects(l)}}render(){return this.state.run(()=>this.renderer.call(this.host,this.host))}runEffects(t){this.state._runEffects(t)}teardown(){this.state.teardown()}pause(){this._active=!1}resume(){this._active=!0}}const U=(...e)=>{const t=new CSSStyleSheet;return t.replaceSync(e.join("")),t},Z=e=>e?.map(t=>typeof t=="string"?U(t):t),$=(e,...t)=>e.flatMap((s,r)=>[s,t[r]||""]).join(""),st=$,q=(e="")=>e.replace(/-+([a-z])?/g,(t,s)=>s?s.toUpperCase():"");function G(e){class t extends I{frag;renderResult;constructor(n,h,b){super(n,b||h),this.frag=h}commit(n){this.renderResult=e(n,this.frag)}}function s(r,n,h){const b=(h||n||{}).baseElement||HTMLElement,{observedAttributes:F=[],useShadowDOM:L=!0,shadowRootInit:A={},styleSheets:M}=h||n||{},E=Z(r.styleSheets||M);class S extends b{_scheduler;static get observedAttributes(){return r.observedAttributes||F||[]}constructor(){if(super(),L===!1)this._scheduler=new t(r,this);else{const u=this.attachShadow({mode:"open",...A});E&&(u.adoptedStyleSheets=E),this._scheduler=new t(r,u,this)}}connectedCallback(){this._scheduler.resume(),this._scheduler.update(),this._scheduler.renderResult?.setConnected(!0)}disconnectedCallback(){this._scheduler.pause(),this._scheduler.teardown(),this._scheduler.renderResult?.setConnected(!1)}attributeChangedCallback(u,o,i){if(o===i)return;let a=i===""?!0:i;Reflect.set(this,q(u),a)}}function N(c){let u=c,o=!1;return Object.freeze({enumerable:!0,configurable:!0,get(){return u},set(i){o&&u===i||(o=!0,u=i,this._scheduler&&this._scheduler.update())}})}const Q=new Proxy(b.prototype,{getPrototypeOf(c){return c},set(c,u,o,i){let a;return u in c?(a=Object.getOwnPropertyDescriptor(c,u),a&&a.set?(a.set.call(i,o),!0):(Reflect.set(c,u,o,i),!0)):(typeof u=="symbol"||u[0]==="_"?a={enumerable:!0,configurable:!0,writable:!0,value:o}:a=N(o),Object.defineProperty(i,u,a),a.set&&a.set.call(i,o),!0)}});return Object.setPrototypeOf(S.prototype,Q),S}return s}class d{id;state;constructor(t,s){this.id=t,this.state=s}}function J(e,...t){let s=H(),r=_[m],n=r.get(s);return n||(n=new e(s,_,...t),r.set(s,n)),n.update(...t)}function f(e){return J.bind(null,e)}function j(e){return f(class extends d{callback;lastValues;values;_teardown;constructor(t,s,r,n){super(t,s),e(s,this)}update(t,s){this.callback=t,this.values=s}call(){const t=!this.values||this.hasChanged();this.lastValues=this.values,t&&this.run()}run(){this.teardown(),this._teardown=this.callback.call(this.state)}teardown(t){typeof this._teardown=="function"&&(this._teardown(),this._teardown=void 0),t&&(this.lastValues=this.values=void 0)}hasChanged(){return!this.lastValues||this.values.some((t,s)=>this.lastValues[s]!==t)}})}function R(e,t){e[l].push(t)}const rt=j(R),K=e=>e instanceof Element?e:e.startNode||e.endNode||e.parentNode,W=f(class extends d{Context;value;_ranEffect;_unsubscribe;constructor(e,t,s){super(e,t),this._updater=this._updater.bind(this),this._ranEffect=!1,this._unsubscribe=null,R(t,this)}update(e){return this.Context!==e&&(this._subscribe(e),this.Context=e),this.value}call(){this._ranEffect||(this._ranEffect=!0,this._unsubscribe&&this._unsubscribe(),this._subscribe(this.Context),this.state.update())}_updater(e){this.value=e,this.state.update()}_subscribe(e){const t={Context:e,callback:this._updater};K(this.state.host).dispatchEvent(new CustomEvent(v,{detail:t,bubbles:!0,cancelable:!0,composed:!0}));const{unsubscribe:r=null,value:n}=t;this.value=r?n:e.defaultValue,this._unsubscribe=r}teardown(){this._unsubscribe&&this._unsubscribe()}});function X(e){return t=>{const s={Provider:class extends HTMLElement{listeners;_value;constructor(){super(),this.style.display="contents",this.listeners=new Set,this.addEventListener(v,this)}disconnectedCallback(){this.removeEventListener(v,this)}handleEvent(r){const{detail:n}=r;n.Context===s&&(n.value=this.value,n.unsubscribe=this.unsubscribe.bind(this,n.callback),this.listeners.add(n.callback),r.stopPropagation())}unsubscribe(r){this.listeners.delete(r)}set value(r){this._value=r;for(let n of this.listeners)n(r)}get value(){return this._value}},Consumer:e(function({render:r}){const n=W(s);return r(n)},{useShadowDOM:!1}),defaultValue:t};return s}}const nt=f(class extends d{value;values;constructor(e,t,s,r){super(e,t),this.value=s(),this.values=r}update(e,t){return this.hasChanged(t)&&(this.values=t,this.value=e()),this.value}hasChanged(e=[]){return e.some((t,s)=>this.values[s]!==t)}});function Y(e,t){e[p].push(t)}const ut=j(Y),it=f(class extends d{args;constructor(e,t,s){super(e,t),this.updater=this.updater.bind(this),typeof s=="function"&&(s=s()),this.makeArgs(s)}update(){return this.args}updater(e){const[t]=this.args;typeof e=="function"&&(e=e(t)),!Object.is(t,e)&&(this.makeArgs(e),this.state.update())}makeArgs(e){this.args=Object.freeze([e,this.updater])}});f(class extends d{reducer;currentState;constructor(e,t,s,r,n){super(e,t),this.dispatch=this.dispatch.bind(this),this.currentState=n!==void 0?n(r):r}update(e){return this.reducer=e,[this.currentState,this.dispatch]}dispatch(e){this.currentState=this.reducer(this.currentState,e),this.state.update()}});const V=/([A-Z])/gu;f(class extends d{property;eventName;constructor(e,t,s,r){if(super(e,t),this.state.virtual)throw new Error("Can't be used with virtual components.");this.updater=this.updater.bind(this),this.property=s,this.eventName=s.replace(V,"-$1").toLowerCase()+"-changed",this.state.host[this.property]==null&&(typeof r=="function"&&(r=r()),r!=null&&this.updateProp(r))}update(e,t){return[this.state.host[this.property],this.updater]}updater(e){const t=this.state.host[this.property];typeof e=="function"&&(e=e(t)),!Object.is(t,e)&&this.updateProp(e)}updateProp(e){this.notify(e).defaultPrevented||(this.state.host[this.property]=e)}notify(e){const t=new CustomEvent(this.eventName,{detail:{value:e,path:this.property},cancelable:!0});return this.state.host.dispatchEvent(t),t}});f(class extends d{update(){return this.state.host}});function tt({render:e}){const t=G(e),s=X(t);return{component:t,createContext:s}}const{component:at}=tt({render:D});export{d as H,it as a,rt as b,at as c,ut as d,st as e,f as h,nt as u};
